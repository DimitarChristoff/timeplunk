<!doctype html>
<html class="no-js">
<head>
	<meta charset="utf-8">
	<title>timeline</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">
	<link rel="shortcut icon" href="favicon.ico"/>
	<link rel="stylesheet" href="../timeplunk.css"/>
</head>
<body>
	<svg class="tp"></svg>
	<div class="stats">Commits in the mootools-core repo by day</div>
	<script src="../bower_components/jquery/dist/jquery.js"></script>
	<script src="../bower_components/d3/d3.js"></script>
	<script src="../bower_components/d3-tip/index.js"></script>
	<script src="../timeplunk.js"></script>
	<script>

		$.ajax({
			url: 'https://api.github.com/repos/mootools/mootools-core/commits?since=2011-04-14T16:00:49Z',
			dataType: 'jsonp'
		}).then(function(commits){

			var perDay = {};

			commits.data.forEach(function(item){
				var date = new Date(item.commit.committer.date),
					nice = date.getDate() + '/' + (date.getMonth()+1);

				if (perDay[nice] == null){
					perDay[nice] = {
						x: date,
						nice: nice,
						y: 1
					};
				}
				else {
					perDay[nice].y++;
				}
			});

			var data = [];
			for (var k in perDay)
				data.push(perDay[k]);

			data = data.reverse();

			var t = new TimePlunk('svg.tp', {
				maxTicks: 5,
				onBrush: function(a, b){
					console.log(a, b);
				}
			});
			t.setData(data);
			console.log(data);
		});

	</script>
</body>
</html>
